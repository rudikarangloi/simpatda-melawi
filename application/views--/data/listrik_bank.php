<!-- layout -->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>/assets/codebase_layout/dhtmlxlayout.css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>/assets/codebase_layout/skins/dhtmlxlayout_dhx_skyblue.css">
<script src="<?php echo base_url(); ?>/assets/codebase_layout/dhtmlxcommon.js"></script>
<script src="<?php echo base_url(); ?>/assets/codebase_layout/dhtmlxlayout.js"></script>
<script src="<?php echo base_url(); ?>/assets/codebase_layout/dhtmlxcontainer.js"></script>

<!-- tabbar -->
<link rel="STYLESHEET" type="text/css" href="<?php echo base_url(); ?>assets/codebase_tabbar/dhtmlxtabbar.css">
<script  src="<?php echo base_url(); ?>assets/codebase_tabbar/dhtmlxtabbar.js"></script>

<!-- dhtmlxGrid -->
<script src="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxcommon.js"></script>
<script src="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxgrid.js"></script>
<script src="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxgridcell.js"></script>
<script  src="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxgrid_filter.js"></script>
<script  src="<?php echo base_url(); ?>assets/codebase_grid/ext/dhtmlxgrid_pgn.js"></script>
<script  src="<?php echo base_url(); ?>assets/codebase_grid/ext/dhtmlxgrid_splt.js"></script>
<script  src="<?php echo base_url(); ?>assets/codebase_grid/ext/dhtmlxgrid_group.js"></script>
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_grid/ext/dhtmlxgrid_pgn_bricks.css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxgrid.css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_grid/skins/dhtmlxgrid_dhx_skyblue.css">

<!-- Ajax -->
<script src="<?php echo base_url(); ?>assets/codebase_ajax/dhtmlxcommon.js"></script>

<!-- Window -->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_windows/dhtmlxwindows.css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_windows/skins/dhtmlxwindows_dhx_skyblue.css">
<script src="<?php echo base_url(); ?>assets/codebase_windows/dhtmlxwindows.js"></script>
<script src="<?php echo base_url(); ?>assets/codebase_windows/dhtmlxcontainer.js"></script>
<script src="<?php echo base_url(); ?>/assets/window.js"></script>

<!-- Modal -->
<link href="<?php echo base_url();?>assets/modal/SyntaxHighlighter.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="<?php echo base_url();?>assets/modal/shCore.js" language="javascript"></script>
<script type="text/javascript" src="<?php echo base_url();?>assets/modal/shBrushJScript.js" language="javascript"></script>
<script type="text/javascript" src="<?php echo base_url();?>assets/modal/ModalPopups.js" language="javascript"></script>

<!-- connector -->
<script src="<?php echo base_url(); ?>assets/codebase_connector/common/dhtmlx.js" type="text/javascript" charset="utf-8"></script>
<script src="<?php echo base_url(); ?>assets/codebase_connector/connector.js" type="text/javascript" charset="utf-8"></script>

<!-- calendar begin-->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_calendar/dhtmlxcalendar.css" />
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_calendar/skins/dhtmlxcalendar_dhx_skyblue.css" />
<script type="text/javascript" src="<?php echo base_url(); ?>assets/codebase_calendar/dhtmlxcalendar.js"></script>
<script type="text/javascript" src="<?php echo base_url();?>assets/numberFormat.js"></script>

<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_editor/skins/dhtmlxeditor_dhx_skyblue.css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_toolbar/skins/dhtmlxtoolbar_dhx_skyblue.css">
<script src="<?php echo base_url(); ?>assets/codebase_editor/dhtmlxcommon.js"></script>
<script src="<?php echo base_url(); ?>assets/codebase_editor/dhtmlxeditor.js"></script>
<script src="<?php echo base_url(); ?>assets/codebase_editor/ext/dhtmlxeditor_ext.js"></script>
<script src="<?php echo base_url(); ?>assets/codebase_toolbar/dhtmlxtoolbar.js"></script>

<script type="text/javascript" src="<?php echo base_url();?>assets/jquery-1.6.1.min.js"></script>
<script type="text/javascript" src="<?php echo base_url();?>assets/jquery.price_format.js"></script>

<script type="text/javascript" language="javascript">
	var iBaseUrl	= '<?php echo base_url();?>';
	var iSaveClass	= iBaseUrl + 'index.php' + '/sptpd_listrik/simpan_sptpd';
	var iDelClass	= iBaseUrl + 'index.php' + '/sptpd_listrik/delete_sptpd';
	var iViewClass	= iBaseUrl + 'index.php' + '/sptpd_listrik/data_bank';
	var iGetNPWPDClass	= iBaseUrl + 'index.php' + '/sptpd_listrik/get_npwpd';
	var iGetDataByIdClass	= iBaseUrl + 'index.php' + '/sptpd_listrik/get_data_by_id';
	var iGenGolTarifClass	= iBaseUrl + 'index.php' + '/sptpd_listrik/zieGenGolonganTarif';
	var iGenGolTarifClass2	= iBaseUrl + 'index.php' + '/sptpd_listrik/zieGenGolonganTarif2';
</script>
<style>
	body {
		background:#FFF;
	}
</style>
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxcalendar.css"></link>

<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_grid/dhtmlxgrid.css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/codebase_grid/skins/dhtmlxgrid_dhx_skyblue.css">


<div style="height:100%; overflow:auto;">

<h2 style="margin:30px 5px 25px 30px;">SPTPD Penerangan Jalan ( Bank )</h2>
	
<div id="a_tabbar" style="width:1000px; height:515px; margin-left:30px;"></div>
  <div id="C1" style="background-color: #B3D9F0">
			<form name="frmData" id="frmData" method="post">
			    <input type="hidden" name="id" id="id" size="35" />
                <input type="hidden" name="sptpd" id="sptpd" size="35" />
                <input type="hidden" name="set" id="set" size="35" />
				<table border="0">
					<tr valign="top">
						<td width="25%" style="padding-left:15px;">No SPTPD</td>
						<td width="25%"><input type="text" name="txtnosptpd_a" id="txtnosptpd_a" size="20" style="background-color:#FFFFCC;" maxlength=10 disabled/>&nbsp;<input type="text" name="txtnosptpd_b" id="txtnosptpd_b" size="10" style="background-color:#FFFFCC;" disabled/></td>
						<td width="15%">&nbsp;</td>
						<td width="30%">&nbsp;</td>
					</tr>
					<tr valign="top">
						<td style="padding-left:15px;" rowspan=2>Masa Pajak</td>
						<td><?php echo $ctl_masapajak1; ?> s.d <?php echo $ctl_masapajak2; ?></td>
						<td>Tata Cara Perhitungan</td>
						<td><?php echo $ctl_carahitung; ?></td>
					</tr>
					<tr valign="top">
						<td><input type="text" name="txt_tgl_masa_pajak3" id="txt_tgl_masa_pajak3" size="12" readonly />&nbsp; <i>s.d</i> <input type="text" name="txt_tgl_masa_pajak4" id="txt_tgl_masa_pajak4" size="12" readonly />&nbsp;</td>
						<td style="padding-left:15px;">Diterima Tanggal</td>
						<td><input type="text" name="txt_tgl_diterima" id="txt_tgl_diterima" size="12" /></td>
					</tr>

					<tr valign="top">
						<td style="padding-left:15px;">Tahun Pajak</td>
						<td><?php echo $ctl_tahunpajak; ?></td>
						<td style="padding-left:15px;">&nbsp;&nbsp;&nbsp;Petugas Input</td>
						<td><select name="petugas" id="petugas" disabled>
              			<option value="<?php echo $ctl_petugasinput; ?>"><?php echo $ctl_petugasinput; ?></option>
         	  			</select></td>
					</tr>
					<tr valign="top">	
						<td style="padding-left:15px;" valign="top">NPWPD</td>
						<td><input type="text" name="txt_npwpd" id="txt_npwpd" style="text-transform:uppercase; background-color: #FFCC99;" />&nbsp;<input type="button" value="Cari" onclick="getDataNPWPD()" name="btncarinpwpd" /></td>
						<td style="padding-left:15px;">&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
					<tr valign="top">
						<td style="padding-left:15px;">Nama Perusahaan</td>
						<td><input type="text" name="txt_nama_perusahaan" id="txt_nama_perusahaan" style="background-color:#FFFFCC;" size=30/></td>
						<td style="padding-left:15px;">&nbsp;&nbsp;&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
					<tr valign="top">
						<td style="padding-left:15px;">Alamat Perusahaan</td>
						<td><input type="text" name="txt_alamat" id="txt_alamat" style="background-color:#FFFFCC;" size=30/></td>
						<td style="padding-left:15px;">&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<td colspan=4><b><i><u>A. Data Obyek Pajak</u></i></b></td>
					</tr>
					<tr>
						<td style="padding-left:10px;" valign="top"><div id="dv_asal_listrik"><font size="-1">Golongan Penerangan Jalan</font></td>
						<td valign="top"><input type="text" name="txt_asal_listrik" id="txt_asal_listrik_pln" value="4.1.1.05.01" disabled="disabled" /></td>
						<td valign="top"><font size="-1">Daya Listrik</font></td>
						<td valign="top"><input type="text" name="txt_daya_listrik" id="txt_daya_listrik" size="15" /></td>
					</tr>
					<tr>
						<td style="padding-left:10px;" valign="top"><font size="-1">Jenis Kategori Tarif</font></td>
						<td ><div id="dv_gol_tarif" name="dv_gol_tarif">
						<select name="txt_gol_tarif" id="txt_gol_tarif" onchange="genGolTarif2();" disabled="disabled">
                        	<option value=""></option>
                        	<?php 
							foreach($ctl_golongantarif->result() as $rs) {
								echo "<option value=".$rs->kd_rek.">".$rs->nm_rek."</option>";
							}
							?>
                        </select></div></td>
						<td valign="top"><font size="-1">Tarif Per KWH Rp.</font></td>
						<td valign="top"><input type="text" name="txt_tarif_kwh" id="txt_tarif_kwh" size="15" /></td>
					</tr>
					<tr>
						<td style="padding-left:10px;" valign="top">&nbsp;</td>
						<td><div id="dv_golongan_tarif"></div></td>
						<td valign="top"><font size="-1">Penggunaan Listrik </font></td>
						<td valign="top"><input type="text" name="txt_pemakaian" id="txt_pemakaian" size="15" onblur="HitungDasarPengenaan()" /> KWH</td>
					</tr>
					<!--<tr>
						<td style="padding-left:10px;" valign="top">&nbsp;</td>
						<td >&nbsp;</td>
						<td valign="top"><font size="-1">Dasar Pengenaan Rp.</font></td>
						<td valign="top"><input type="text" name="txt_jml_bayar" id="txt_jml_bayar" size="15" /></td>
					</tr>
					<tr>
						<td colspan=4><b><u>B. Data Masa Pajak Penerangan Jalan(Self Assesment) </u></b></td>
					</tr>
					<tr>
						<td colspan=4><b><u>1. Jumlah Pembayaran dan Pajak Terhutang untuk Masa Pajak sebelumnya (Akumulasi dari awal Masa Pajak dalam Tahun Pajak Tertentu) </u></b></td>
					</tr>
					<tr>
						<td style="padding-left:15px;" valign="top" colspan=3>&nbsp;&nbsp;a. Masa Pajak</td>
						<td ><input type="text" name="txt_tgl_masa_pajak11" id="txt_tgl_masa_pajak11" size="12" readonly />&nbsp; <i>s.d</i> <input type="text" name="txt_tgl_masa_pajak21" id="txt_tgl_masa_pajak21" size="12" readonly />&nbsp;</td>
					</tr>
					<tr>
						<td colspan=2 style="padding-left:15px;" valign="top">&nbsp;&nbsp;b. Dasar Pengenaan (Jumlah Pembayaran yang diterima)</td>
						<td align=right>Rp.</td>
						<td ><input type="text" name="txt_jml_bayar1" id="txt_jml_bayar1" size="15" onblur="hitungPajak1()" /> </td>
					</tr>
					<tr>
						<td colspan=3 style="padding-left:15px;" valign="top">&nbsp;&nbsp;c. Tarif Pajak sesuai perda</td>
						<td ><input type="text" name="txt_tarif_pajak1" id="txt_tarif_pajak1" size="15" disabled="disabled"/> % </td>
					</tr>
					<tr>
						<td colspan=2 style="padding-left:15px;" valign="top">&nbsp;&nbsp;d. Pajak Terhutang (b x c)</td>
						<td align=right>Rp.</td>
						<td ><input type="text" name="txt_pajak_terutang1" id="txt_pajak_terutang1" size="15" disabled="disabled"/>  </td>
					</tr>-->
					<tr>
						<td colspan=4><b><u>Jumlah Pembayaran dan Pajak Terhutang untuk Masa Pajak Sekarang (Lampirkan foto copy dokumen) </u></b></td>
					</tr>
					<!--<tr>
						<td style="padding-left:15px;" valign="top" colspan=3>&nbsp;&nbsp;a. Masa Pajak</td>
						<td ><input type="text" name="txt_tgl_masa_pajak12" id="txt_tgl_masa_pajak12" size="12" readonly />&nbsp; <i>s.d</i> <input type="text" name="txt_tgl_masa_pajak22" id="txt_tgl_masa_pajak22" size="12" readonly />&nbsp;</td>
					</tr>-->
					<tr>
						<td colspan=2 style="padding-left:15px;" valign="top">&nbsp;&nbsp;a. Dasar Pengenaan (Jumlah Pembayaran yang diterima)</td>
						<td align=right>Rp.</td>
						<td ><input type="text" style="text-align:right" name="txt_jml_bayar2" id="txt_jml_bayar2" size="15" /> </td>
					</tr>
					<tr>
						<td colspan=3 style="padding-left:15px;" valign="top">&nbsp;&nbsp;b. Tarif Pajak sesuai perda</td>
						<td ><input type="text" name="txt_tarif_pajak2" style="text-align:right" id="txt_tarif_pajak2" size="10" disabled="disabled"/> % </td>
					</tr>
					<tr>
						<td colspan=2 style="padding-left:15px;" valign="top">&nbsp;&nbsp;c. Pajak Terhutang ( a x b )</td>
						<td align=right>Rp.</td>
						<td ><input type="text" name="txt_pajak_terutang2" id="txt_pajak_terutang2" style="text-align:right" size="15" disabled="disabled"/>  </td>
					</tr>
                    <tr>
                    	<td colspan="4">&nbsp;</td>
                    </tr>
					<tr>
						<td colspan="4" style="padding-left:15px; background-color:#FFCC99;"><input type="button" value="Baru" onclick="addNew()" name="btnaddnew" id="btnaddnew" style="width:90px;"/>&nbsp;&nbsp;<input type="button" value="Simpan" onclick="simpanData()" name="btnsimpan" id="btnsimpan" style="width:90px;" disabled/>&nbsp;&nbsp;<!--<input type="button" value="Edit" onclick="editData()" name="btnedit" id="btnedit" style="width:90px;" disabled/>&nbsp;&nbsp;<input type="button" value="Hapus" onclick="deleteData()" name="btndel" id="btndel" style="width:90px;" disabled/>&nbsp;&nbsp;--><input type="button" value="Cetak" onclick="cetak()" name="btncetak" style="width:90px;" id="btncetak" disabled/>&nbsp;&nbsp;<input type="button" value="SPTPD Kosong" onclick="kosong()" name="null" id="null" /></td>
					</tr>
				</table>
			<!--<select name="ctl_req" id="ctl_req" style="visibility:hidden">
				<option value="txtnosptpd_a">No SPTPD</option>
				<option value="txt_npwpd">NPWPD</option>
				<option value="txt_tgl_diterima">Tanggal Diterima</option>
				<option value="txt_jml_bayar">Pajak Diterima</option>
			</select>-->
			
			</form>
<br />
</div>

<!--<div id="C2">
<div style="padding:0 1px 0 0px;">
	<div id="gridContent" height="500px" width="995px" style="margin-bottom:10px;"></div>
	<div id="pagingArea" width="350px" style="background-color:white;"></div>
</div>	
</div>-->  

<div id="objLIS" style="display:none;">
<br />
<form name="frmLIS" id="frmLIS" method="post" action="javascript:void(0);">
<table width="790" border="0">
  	<tr>
		<td style="padding-left:15px;">Cari data berdasarkan 
      	<select name="fil" id="fil" >
        	<option value="1">NPWPD Perusahaan</option>
            <option value="2">Nama Perusahaan</option>
            <option value="3">Nama Pemilik</option>
        </select></td>
        <td><input type="text" name="values" id="values" size="35" style="text-transform:uppercase; background-color: #FFCC99;" /></td>
        <td><input type="button" onclick="lihat3()" name="filter3" value="Cari" style="padding-left:20px; padding-right:20px"/>&nbsp;
        <input type="button" onclick="batal()" name="can" value="Keluar" style="padding-left:20px; padding-right:20px"/></td>
	</tr>
</table>
</form>
<div style="padding:0 75px 0 15px;">
	<div id="gridsLIS" width="750px" height="250px" style="margin-bottom:10px;"></div>
    <div id="pagingArea" width="350px" style="background-color:white;"></div>
</div>
</div>
<script language="javascript">
	var base_url = "<?php echo base_url(); ?>";
	
	function kosong(){
		window.open('<?php echo site_url(); ?>/listrik_pdf', '', 'height=700,width=1000,scrollbars=yes');
	}
	
	$(function() {         
    	$('#txt_jml_bayar2').priceFormat({
        	prefix: '',
            centsSeparator: ',',
            thousandsSeparator: '.',
			centsLimit: 0
         });
		 $("#txt_jml_bayar2").keyup(function(){
			 hitung($('#txt_jml_bayar2').unmask());
		});
	});
	
	function hitung(jumlahDP){
		if(jumlahDP=="0") { return; }
		if(jumlahDP=="") {
			nilai_pot = 0;
			document.frmData.txt_pajak_terutang2.value = 0;
		} else {
			nilai_pot = parseInt(jumlahDP);	
		}
		total = (nilai_pot*document.frmData.txt_tarif_pajak2.value)/100;
		document.frmData.txt_pajak_terutang2.value = format_number(total);
	}
	
	function cetak() {
		var gabung = document.frmData.txtnosptpd_a.value+'/'+document.frmData.txtnosptpd_b.value;
		window.open('<?php echo site_url(); ?>/sptpd_listrik/cetak?sptpd='+gabung, '', 'height=700,width=1000,scrollbars=yes');
	}
	
	tabbar = new dhtmlXTabBar("a_tabbar", "top");
	tabbar.setSkin('dhx_skyblue');
	tabbar.setImagePath(base_url+"assets/codebase_tabbar/imgs/");
	tabbar.addTab("a1", "Input Data", "300px");
	//tabbar.addTab("a2", "Listing Data", "300px");
	tabbar.setContent("a1", "C1"); 
	//tabbar.setContent("a2", "C2");
	tabbar.setTabActive("a1");
	
	disabledData1();
	
	cal1 = new dhtmlxCalendarObject('txt_tgl_diterima');
	cal1.setDateFormat('%d/%m/%Y');
	
	wLIS = dhxWins.createWindow("wLIS",0,0,800,400);
	wLIS.setText("Pencarian Data Perusahaan");
	wLIS.button("park").hide();
	wLIS.button("close").hide();
	wLIS.button("minmax1").hide();
	wLIS.hide();

	function getDataNPWPD() {
		wLIS.show();
    	//wLIS.setModal(true);
		wLIS.center();
		wLIS.attachObject('objLIS');
	}
	
	function batal() {
		wLIS.hide();
		wLIS.setModal(false);
		document.frmLIS.fil.value = "0";
		document.frmLIS.values.value = "";
		//grids.clearAll();
	}
	
	function lihat3() {
		op = document.frmLIS.fil.value;
		if(op==1||op==2||op==3){
			if(document.frmLIS.values.value=="") {
			alert("Value Pencarian Tidak Boleh Kosong");
			document.frmLIS.values.focus();
			return;
			}
		}
		nilai = document.frmLIS.values.value;
		gridLIS.clearAll();
		gridLIS.loadXML("<?php echo site_url(); ?>/sptpd_listrik/load_perusahaan/"+op+"/"+nilai,function() {
			statusEnding();
		});
	}
	
	gridLIS= new dhtmlXGridObject('gridsLIS');
	gridLIS.setImagePath("<?php echo base_url(); ?>/assets/codebase_grid/imgs/");
	gridLIS.setHeader("id, npwpd_perusahaan, nama_perusahaan, alamat_perusahaan, telp, kodepos, npwpd_pemilik, nama_pemilik, alamat_pemilik, telp_pemilik, kodepos_pemilik, jenis_usaha, status_usaha, jenis_pajak, jenis_pajak_detail, tgl_daftar");

	gridLIS.setInitWidths("50,100,150,100,100,100,100,100,100,100,100,100,100,100,100,100,100");
	gridLIS.setColAlign("center,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left");
	gridLIS.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro");
	gridLIS.setColSorting("str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str");
	gridLIS.enablePaging(true,1000,1000,"pagingArea",true);
	gridLIS.setPagingSkin("bricks");
	gridLIS.setSkin("dhx_skyblue");
	gridLIS.setColumnHidden(0,true);
	gridLIS.attachEvent("onRowDblClicked", selectedOpenData2);
	gridLIS.init();
	
	function selectedOpenData2(id) {
		document.frmData.txt_npwpd.value 	= gridLIS.cells(id,1).getValue();
		document.frmData.txt_nama_perusahaan.value	= gridLIS.cells(id,2).getValue();
		document.frmData.txt_alamat.value  = gridLIS.cells(id,3).getValue();
		batal();
		enableData1();
	}
	
	grid = new dhtmlXGridObject('gridContent');
	grid.setImagePath("<?php echo base_url(); ?>/assets/codebase_grid/imgs/");
	
	grid.setHeader("id, no_sptpd, npwpd, nama_perusahaan, alamat, cara_hitung, tgl_diterima, asal_listrik, gol_tarif, daya_listrik, tarif_kwh, pemakaian, jml_bayar, masa_pajak11, masa_pajak21, jml_bayar1, tarif_pajak1, pajak_terutang1, masa_pajak12, masa_pajak22, jml_bayar2, tarif_pajak2, pajak_terutang2, author, created, modified, petugas_input,",null,["text-align:center","text-align:center","text-align:center","text-align:center"]);
	//grid.attachHeader("#text_filter,#text_filter,#text_filter");
	grid.setInitWidths("50,150,150,170,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100");
	grid.setColAlign("center,left,left,left,left,right,right,right,left,left,right,left");
	grid.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ron,ron,ron,ro,ro,ro,ro");
	grid.setColSorting("str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str");
	grid.setSkin("dhx_skyblue");
	grid.enableSmartRendering(true);
	grid.enablePaging(true,5,10,"pagingArea",true);
	grid.setColumnHidden(12,true);
	grid.setColumnHidden(13,true);
	grid.setColumnHidden(14,true);
	grid.setColumnHidden(15,true);
	grid.setColumnHidden(16,true);
	grid.setColumnHidden(17,true);
	grid.setColumnHidden(18,true);
	grid.setColumnHidden(19,true);
	grid.setNumberFormat("0,000",20,",",".");
	grid.setNumberFormat("0,000",21,",",".");
	grid.setNumberFormat("0,000",22,",",".");
	grid.attachEvent("onRowDblClicked", selectedOpenData);
	grid.loadXML("<?php echo site_url(); ?>/sptpd_listrik/data_bank");
	grid.init();
	
	function genGolTarif(id){	
		var postStr='id='+id+'&ctlid=txt_gol_tarif';
		//alert(postStr);
		//return;
		statusLoading();
		dhtmlxAjax.post(iGenGolTarifClass, postStr, responePOST3);
	}
	
	function genGolTarif2(){
		if(document.frmData.txt_gol_tarif.value=="") {
			alert("Jenis Kategori Tarif Tidak Boleh Kosong");
			document.frmData.txt_gol_tarif.focus();
			return;
		}
		var postGol =
			"gol=" + document.frmData.txt_gol_tarif.value;
		
		statusLoading();
		dhtmlxAjax.post(base_url+'index.php/sptpd_listrik/tarif', postGol, respJns);			
	}
	
	function respJns(loader) {
		if (loader.xmlDoc.readyState == 4) {
			if (loader.xmlDoc.status == 200) {
				result = loader.xmlDoc.responseText;
				statusEnding();
				if(result!=0) {
					document.frmData.txt_tarif_pajak2.value = result;
					document.frmData.txt_jml_bayar2.disabled = false;
				} else {
					alert("Silakan Pilih Jenis Kategori Tarif");
				}
			} else {
				 alert('There was a problem with the request.');
			}
		}
	}
	
	function responePOST3(loader) {
		if (loader.xmlDoc.readyState == 4) {
			if (loader.xmlDoc.status == 200) {
				result = loader.xmlDoc.responseText;
				//alert(result);
				if(result!="") {			
					eval(result);		
				}
				statusEnding();
				return true;
			} else {
				alert(loader.xmlDoc.status);
				//alert('There was a problem with the request.');
			}
		}
	}
	
	//function readTahunPajak(){
		//var iCurrentYear = parseInt('<?//php echo Date("Y"); ?>');
		//var iThn = parseInt(document.frmData.txt_thn_masa_pajak.value);
		//alert(iYear);
		//return;
		/*if(iThn>=iCurrentYear){
			document.frmData.txt_tgl_masa_pajak11.value='';
			document.frmData.txt_tgl_masa_pajak21.value='';
			document.frmData.txt_jml_bayar1.value='';
			document.frmData.txt_tarif_pajak1.value='';
			document.frmData.txt_pajak_terutang1.value='';
			getLastDate('txt_thn_masa_pajak','txt_bln_masa_pajak1','txt_bln_masa_pajak2','txt_tgl_masa_pajak12', 'txt_tgl_masa_pajak22');
			document.frmData.txt_jml_bayar2.value=document.frmData.txt_jml_bayar.value;
			document.frmData.txt_tarif_pajak2.value=document.frmData.set.value;
			
			
		}else{
			document.frmData.txt_tgl_masa_pajak12.value='';
			document.frmData.txt_tgl_masa_pajak22.value='';
			document.frmData.txt_jml_bayar2.value='';
			document.frmData.txt_tarif_pajak2.value='';
			document.frmData.txt_pajak_terutang2.value='';
			getLastDate('txt_thn_masa_pajak','txt_bln_masa_pajak1','txt_bln_masa_pajak2','txt_tgl_masa_pajak11', 'txt_tgl_masa_pajak21');
			document.frmData.txt_jml_bayar1.value=document.frmData.txt_jml_bayar.value;
			document.frmData.txt_tarif_pajak1.value=document.frmData.set.value;
			
		//}
		return;
	}*/
	
	function hitungPajak1(){
		document.frmData.txt_pajak_terutang1.value=parseInt(document.frmData.txt_jml_bayar1.value)*parseFloat(document.frmData.txt_tarif_pajak1.value)/100;
	}
	
	function hitungPajak2(){
		document.frmData.txt_pajak_terutang2.value=parseInt(document.frmData.txt_jml_bayar2.value)*parseFloat(document.frmData.txt_tarif_pajak2.value)/100;
	}

	function HitungDasarPengenaan(){
		var tarif = document.frmData.txt_tarif_kwh.value;
		var pemakaian = document.frmData.txt_pemakaian.value;
		//var bayar = tarif * pemakaian;
		//document.frmData.txt_jml_bayar.value=bayar;
		readTahunPajak();
	}

	function selectedOpenData(id) {
		kosongfrmData1();
		document.frmData.sptpd.value = grid.cells(id,1).getValue();
		document.frmData.txt_jml_bayar2.value=format_number(grid.cells(id,20).getValue());
		document.frmData.txt_tarif_pajak2.value=format_number(grid.cells(id,21).getValue());
		document.frmData.txt_pajak_terutang2.value=format_number(grid.cells(id,22).getValue());
		
		var postStr='id='+id +
		'&no_sptpd='+ grid.cells(id,1).getValue();
		
		//alert(postStr);
		//return;
		statusLoading();
		dhtmlxAjax.post(iGetDataByIdClass, postStr, responePOST3);
		document.frmData.btnaddnew.disabled=true;
		document.frmData.btnsimpan.disabled=true;
		/*document.frmData.btnedit.disabled=false;
		document.frmData.btndel.disabled=false;*/
		document.frmData.btncetak.disabled=false;
		tabbar.setTabActive("a1");
	}

	
	function addNew() {
		document.frmData.btnaddnew.disabled=false;
		document.frmData.btnsimpan.disabled=false;
		/*document.frmData.btnedit.disabled=true;
		document.frmData.btndel.disabled=true;*/
		document.frmData.btncetak.disabled=true;
		enableData1();
		kosongfrmData1();
	}
	
	function editData() {
		var name=prompt("Please enter your password","");
		if (name!=null){
			if(name=='passwordnyadpka'){
				document.frmData.btnaddnew.disabled=false;
				document.frmData.btnsimpan.disabled=false;
				/*document.frmData.btnedit.disabled=false;
				document.frmData.btndel.disabled=false;*/
				document.frmData.btncetak.disabled=false;
				document.frmData.txt_jml_bayar2.disabled=false;
				enableData1();
			} else {
				alert("Password anda salah");
			}
		} else {
			alert("Password anda salah");
		}
	}

	function enableData1(){
		document.frmData.txtnosptpd_a.readonly=true;
		document.frmData.txtnosptpd_b.readonly=true;
		document.frmData.txt_bln_masa_pajak1.disabled=false;
		document.frmData.txt_bln_masa_pajak2.disabled=false;
		document.frmData.txt_tgl_masa_pajak3.disabled=false;
		document.frmData.txt_tgl_masa_pajak4.disabled=false;
		document.frmData.txt_thn_masa_pajak.disabled=false;
		document.frmData.txt_cara_hitung.disabled=false;
		document.frmData.txt_tgl_diterima.disabled=false;
		document.frmData.petugas.disabled=false;
		
		document.frmData.txt_npwpd.disabled=false;
		document.frmData.btncarinpwpd.disabled=false;
		document.frmData.txt_nama_perusahaan.disabled=false;
		document.frmData.txt_alamat.disabled=false;
		//document.frmData.txt_asal_listrik_pln.disabled=false;
		//document.frmData.txt_asal_listrik_nonpln.disabled=false;
		document.frmData.txt_daya_listrik.disabled=false;
		document.frmData.txt_pemakaian.disabled=false;
		document.frmData.txt_gol_tarif.disabled=false;
		document.frmData.txt_tarif_kwh.disabled=false;
		//document.frmData.txt_jml_bayar.disabled=false;
		
		/*document.frmData.txt_tgl_masa_pajak11.disabled=false;
		document.frmData.txt_tgl_masa_pajak21.disabled=false;
		document.frmData.txt_jml_bayar1.disabled=false;
		document.frmData.txt_tarif_pajak1.disabled=false;
		document.frmData.txt_pajak_terutang1.disabled=false;
		
		document.frmData.txt_tgl_masa_pajak12.disabled=false;
		document.frmData.txt_tgl_masa_pajak22.disabled=false;*/
		//document.frmData.txt_jml_bayar2.disabled=false;
		/*document.frmData.txt_tarif_pajak2.disabled=false;
		document.frmData.txt_pajak_terutang2.disabled=false;*/
		
	}
	
	function disabledData1(){
		document.frmData.txtnosptpd_a.readonly=true;
		document.frmData.txtnosptpd_b.readonly=true;
		document.frmData.txt_bln_masa_pajak1.disabled=true;
		document.frmData.txt_bln_masa_pajak2.disabled=true;
		document.frmData.txt_tgl_masa_pajak3.disabled=true;
		document.frmData.txt_tgl_masa_pajak4.disabled=true;
		document.frmData.txt_thn_masa_pajak.disabled=true;
		document.frmData.txt_cara_hitung.disabled=true;
		document.frmData.txt_tgl_diterima.disabled=true;
		document.frmData.petugas.disabled=true;
		//alert('1...');
		document.frmData.txt_npwpd.disabled=true;
		document.frmData.btncarinpwpd.disabled=true;
		document.frmData.txt_nama_perusahaan.disabled=true;
		document.frmData.txt_alamat.disabled=true;
		//alert('2...');
		//document.frmData.txt_asal_listrik_pln.disabled=true;
		//document.frmData.txt_asal_listrik_nonpln.disabled=true;
		document.frmData.txt_daya_listrik.disabled=true;
		document.frmData.txt_pemakaian.disabled=true;
		document.frmData.txt_gol_tarif.disabled=true;
		document.frmData.txt_tarif_kwh.disabled=true;
		//document.frmData.txt_jml_bayar.disabled=true;
		//alert('3...');
		/*document.frmData.txt_tgl_masa_pajak11.disabled=true;
		document.frmData.txt_tgl_masa_pajak21.disabled=true;
		document.frmData.txt_jml_bayar1.disabled=true;
		document.frmData.txt_tarif_pajak1.disabled=true;
		document.frmData.txt_pajak_terutang1.disabled=true;
		//alert('4...');
		document.frmData.txt_tgl_masa_pajak12.disabled=true;
		document.frmData.txt_tgl_masa_pajak22.disabled=true;*/
		document.frmData.txt_jml_bayar2.disabled=true;
		document.frmData.txt_tarif_pajak2.disabled=true;
		document.frmData.txt_pajak_terutang2.disabled=true;
		//alert('5...');
		
	}

	function kosongfrmData1(){
		document.frmData.id.value='';
		document.frmData.txtnosptpd_a.value='';
		document.frmData.txtnosptpd_b.value='';
		document.frmData.txt_bln_masa_pajak1.value='';
		document.frmData.txt_bln_masa_pajak2.value='';
		document.frmData.txt_tgl_masa_pajak3.value='';
		document.frmData.txt_tgl_masa_pajak4.value='';
		document.frmData.txt_thn_masa_pajak.value='';
		document.frmData.txt_cara_hitung.value='';
		document.frmData.txt_tgl_diterima.value='';
		document.frmData.petugas.value='';
		//alert('1...');
		document.frmData.txt_npwpd.value='';
		
		document.frmData.txt_nama_perusahaan.value='';
		document.frmData.txt_alamat.value='';
		//alert('2...');
		//document.frmData.txt_asal_listrik_pln.checked=false;
		//document.frmData.txt_asal_listrik_nonpln.checked=false;
		document.frmData.txt_daya_listrik.value='';
		document.frmData.txt_pemakaian.value='';
		document.frmData.txt_gol_tarif.value='';
		document.frmData.txt_tarif_kwh.value='';
		//document.frmData.txt_jml_bayar.value='';
		//alert('3...');
		/*document.frmData.txt_tgl_masa_pajak11.value='';
		document.frmData.txt_tgl_masa_pajak21.value='';
		document.frmData.txt_jml_bayar1.value='';
		document.frmData.txt_tarif_pajak1.value='';
		document.frmData.txt_pajak_terutang1.value='';
		//alert('4...');
		document.frmData.txt_tgl_masa_pajak12.value='';
		document.frmData.txt_tgl_masa_pajak22.value='';*/
		document.frmData.txt_jml_bayar2.value=0;
		document.frmData.txt_tarif_pajak2.value=0;
		document.frmData.txt_pajak_terutang2.value=0;
		//alert('5...');
	}

	function simpanData() {
		if(document.frmData.txt_npwpd.value==""){
			alert("NPWPD Tidak Boleh Kosong");
			document.frmData.txt_npwpd.focus();
			return;
		}
		
		if(document.frmData.txt_tgl_diterima.value==""){
			alert("Tanggal Penerimaan Tidak Boleh Kosong");
			document.frmData.txt_tgl_diterima.focus();
			return;
		}
		
		jml_bayar2 = ($('#txt_jml_bayar2').unmask());		
		/*if(jml_bayar2 < 5000000){
			alert("Maaf Dasar Pengenaan Kurang dari 5 Juta");
			document.frmData.txt_jml_bayar2.focus();
			return;
		}*/
		//var ctlreq = document.frmData.ctl_req;
		if(document.frmData.txtnosptpd_a.value==''){
			cek();
		} else {
			simpan2();
		}
	}
		
	function cek(){
		var postCek =
			"npwpd=" + document.frmData.txt_npwpd.value +
			"&awal=" + document.frmData.txt_tgl_masa_pajak3.value +
			"&akhir=" + document.frmData.txt_tgl_masa_pajak4.value;
		statusLoading();
		dhtmlxAjax.post(base_url+'index.php/sptpd_listrik/ricek', postCek, resPOST);
	}
	
	function resPOST(loader) {
		if (loader.xmlDoc.readyState == 4) {
			if (loader.xmlDoc.status == 200) {
				result = loader.xmlDoc.responseText;
				if(result!=0) {
					alert(result);
					statusEnding();
					return true;
				} else {
					simpan2();
					statusEnding();
					return true;
				}
			} else {
				 alert('There was a problem with the request.');
			}
		}
	}
		
	function simpan2(){
		var postStr = "id=" + document.frmData.id.value;
		postStr = postStr + "&txt_thn_masa_pajak"  + "=" + document.getElementById("txt_thn_masa_pajak").value;
		postStr = postStr + "&txt_bln_masa_pajak1"  + "=" + document.getElementById("txt_bln_masa_pajak1").value;
		postStr = postStr + "&txt_bln_masa_pajak2"  + "=" + document.getElementById("txt_bln_masa_pajak2").value;
		
		postStr = postStr + "&txt_tgl_masa_pajak3=" + document.frmData.txt_tgl_masa_pajak3.value;
		postStr = postStr + "&txt_tgl_masa_pajak4=" + document.frmData.txt_tgl_masa_pajak4.value;
		postStr = postStr + "&txt_thn_masa_pajak=" + document.frmData.txt_thn_masa_pajak.value;
		postStr = postStr + "&txt_cara_hitung=" + document.frmData.txt_cara_hitung.value;
		postStr = postStr + "&txt_tgl_diterima=" + document.frmData.txt_tgl_diterima.value;
		postStr = postStr + "&txt_petugas_input=" + document.frmData.petugas.value;
		//alert('1...');
		postStr = postStr + "&txt_npwpd=" + document.frmData.txt_npwpd.value;
		postStr = postStr + "&no_sptpd"  + "=" + document.frmData.sptpd.value;
		
		postStr = postStr + "&txt_nama_perusahaan=" + document.frmData.txt_nama_perusahaan.value;
		postStr = postStr + "&txt_alamat=" + document.frmData.txt_alamat.value;
		//alert('2...');
		postStr = postStr + "&txt_gol_tarif=" + document.frmData.txt_asal_listrik_pln.value;
		postStr = postStr + "&txt_daya_listrik=" + document.frmData.txt_daya_listrik.value;
		postStr = postStr + "&txt_pemakaian=" + document.frmData.txt_pemakaian.value;
		postStr = postStr + "&txt_asal_listrik=" + document.frmData.txt_gol_tarif.value;
		postStr = postStr + "&txt_tarif_kwh=" + document.frmData.txt_tarif_kwh.value;
		//postStr = postStr + "&txt_jml_bayar=" + document.frmData.txt_jml_bayar.value;
		//alert('3...');
		/*postStr = postStr + "&txt_tgl_masa_pajak11=" + document.frmData.txt_tgl_masa_pajak11.value;
		postStr = postStr + "&txt_tgl_masa_pajak21=" + document.frmData.txt_tgl_masa_pajak21.value;
		postStr = postStr + "&txt_jml_bayar1=" + document.frmData.txt_jml_bayar1.value;
		postStr = postStr + "&txt_tarif_pajak1=" + document.frmData.txt_tarif_pajak1.value;
		postStr = postStr + "&txt_pajak_terutang1=" + document.frmData.txt_pajak_terutang1.value;
		//alert('4...');
		postStr = postStr + "&txt_tgl_masa_pajak12=" + document.frmData.txt_tgl_masa_pajak12.value;
		postStr = postStr + "&txt_tgl_masa_pajak22=" + document.frmData.txt_tgl_masa_pajak22.value;*/
		postStr = postStr + "&txt_jml_bayar2=" + document.frmData.txt_jml_bayar2.value;
		postStr = postStr + "&txt_tarif_pajak2=" + document.frmData.txt_tarif_pajak2.value;
		postStr = postStr + "&txt_pajak_terutang2=" + document.frmData.txt_pajak_terutang2.value;
		//alert('5...');

		statusLoading();
		dhtmlxAjax.post(iSaveClass, postStr, responePOST);
		disabledData1();

		document.frmData.btnaddnew.disabled=false;
		document.frmData.btnsimpan.disabled=false;
		/*document.frmData.btnedit.disabled=false;
		document.frmData.btndel.disabled=false;*/
		document.frmData.btncetak.disabled=false;
		//kosongfrmData1();
	}
	
	statusEnding();

	function statusLoading() {  
	
	   ModalPopups.Indicator("idIndicator2",  
		"Please wait",  
		"<div style=''>" +   
		"<div style='float:left;'><img src='"+iBaseUrl+"/assets/modal/spinner.gif'></div>" +   
		"<div style='float:left; padding-left:10px;'>" +   
		"Permintaan Anda Sedang Diproses... <br/>" +   
		"Tunggu Beberapa Saat." +  
			"<p><a href='javascript:void(0)' onClick='statusEnding()'>Close</a></p>" + 
		"</div>",   
		{  
			width: 300,  
			height: 100  
		}  
		);
			  
		//setTimeout('ModalPopups.Close(\"idIndicator2\");', 3000);  
	}

	function statusEnding() {
		ModalPopups.Close("idIndicator2");
	}
	 
	function refreshData() {
		grid.clearAll();
		grid.loadXML(iViewClass);
	}
	
	function deleteData() {
		var name=prompt("Please enter your password","");
		if (name!=null){
			if(name=='passwordnyadpka'){
				cnf = confirm("Apakah Anda Yakin ?")
				if(cnf) {
					var postStr =
						"sptpd_1=" + document.frmData.txtnosptpd_a.value +
						"&sptpd_2=" + document.frmData.txtnosptpd_b.value;
						statusLoading(iBaseUrl);
					dhtmlxAjax.post(iDelClass, postStr, responePOST1);
				}
				document.frmData.btnaddnew.disabled=false;
				document.frmData.btnsimpan.disabled=true;
				/*document.frmData.btnedit.disabled=true;
				document.frmData.btndel.disabled=true;*/
				document.frmData.btncetak.disabled=true;
				disabledData1();
				kosongfrmData1();
			} else {
				alert("Password anda salah");
			}
		} else {
			alert("Password anda salah");
		}
	}

	function responePOST(loader) {
		if (loader.xmlDoc.readyState == 4) {
			if (loader.xmlDoc.status == 200) {
				result = loader.xmlDoc.responseText;
				if(result) {			
					var potong = result.split('/');
					document.frmData.txtnosptpd_a.value = potong[0];
					document.frmData.txtnosptpd_b.value = potong[1]+'/'+potong[2];
					//refreshData();
					statusEnding();
					alert("Done");
					return true;	
				}
			} else {
				alert(loader.xmlDoc.responseText);
				//alert('There was a problem with the request.');
			}
		}
	}
	
	function responePOST1(loader) {
		if (loader.xmlDoc.readyState == 4) {
			if (loader.xmlDoc.status == 200) {
				result = loader.xmlDoc.responseText;
				if(result) {			
					alert("Done");
					kosongfrmData1();
					refreshData();
					statusEnding();
					return true;	
				}
			} else {
				alert(loader.xmlDoc.responseText);
				//alert('There was a problem with the request.');
			}
		}
	}

	function responePOST2(loader) {
		if (loader.xmlDoc.readyState == 4) {
			if (loader.xmlDoc.status == 200) {
				result = loader.xmlDoc.responseText;
				alert(result);
				if(result!="") {			
					eval(result);	
				}
				statusEnding();
				return true;
			} else {
				alert(loader.xmlDoc.status);
				//alert('There was a problem with the request.');
			}
		}
	}


	function AddLeadingZero(currentField)
	{
		
		//Check if the value length hasn't reach its max length yet
		if (currentField.value.length != currentField.maxLength)
		{
			//Add leading zero(s) in front of the value
			var numToAdd = currentField.maxLength - currentField.value.length;
			var value ="";
			for (var i = 0; i < numToAdd;i++)
			{
			value += "0";
			}
			currentField.value = value + currentField.value;
		}
	}


	function konversiTgl(iTgl){
		var thn = iTgl.substr(0,4);
		var bln = iTgl.substr(5,2);
		var tgl = iTgl.substr(8,2);
		return tgl + "/" + bln + "/" + thn;
	}

	function getTgl(iTgl, retType){
		var thn = iTgl.substr(0,4);
		var bln = iTgl.substr(5,2);
		var tgl = iTgl.substr(8,2);
		
		if(retType=="THN"){
			return thn;
		}
		if(retType=="BLN"){
			return bln;
		}
		if(retType=="TGL"){
			return tgl;
		}
	}

	function getLastDate(iThn, iBln1, iBln2, iTgl1, iTgl2){		
		
		var iThnVal		= document.getElementById(iThn).value;
		var iBln1Val	= document.getElementById(iBln1).value;		
		var iBln2Val	= document.getElementById(iBln2).value;
		
		if(iBln2Val<iBln1Val){
			iBln2Val = iBln1Val;
			document.getElementById(iBln2).value=iBln2Val;
		}
		
		var lastDate = new Date(iThnVal, iBln2Val, 0);
		var lastDateDay = lastDate.getDate();
		
		document.getElementById(iTgl1).value = '01/' + iBln1Val + '/' + iThnVal;
		document.getElementById(iTgl2).value = lastDateDay + '/' + iBln2Val + '/' + iThnVal;	
	}
	
	statusEnding();
</script>
</div>